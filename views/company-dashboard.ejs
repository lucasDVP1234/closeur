<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruteur — THE CLOSERS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        surface: { 50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 800: '#111113', 900: '#09090b', 950: '#050506' },
                        accent: { 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9' },
                        gold: { 300: '#fcd34d', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: #050506; color: #fff; overflow-x: hidden; position: relative; }

        /* Grain */
        body::before {
            content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.5;
        }

        /* Ambient background */
        body::after {
            content: '';
            position: fixed; inset: -20%;
            z-index: 0;
            pointer-events: none;
            background:
                radial-gradient(900px 520px at 18% 12%, rgba(139, 92, 246, 0.16), transparent 60%),
                radial-gradient(820px 460px at 78% 18%, rgba(139, 92, 246, 0.12), transparent 62%),
                radial-gradient(720px 460px at 55% 78%, rgba(124, 58, 237, 0.10), transparent 65%);
            opacity: 0.9;
            filter: saturate(1.05);
        }
        body > * { position: relative; z-index: 1; }

        .baguette-surface {
            background: linear-gradient(180deg, rgba(255,255,255,0.045), rgba(255,255,255,0.015));
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow:
                0 30px 90px -50px rgba(0,0,0,0.8),
                0 0 0 1px rgba(255,255,255,0.02) inset;
        }
    </style>
</head>
<body class="min-h-screen">

    <%- include('partials/nav', { user: (typeof user !== 'undefined' ? user : null) }) %>

    <div class="max-w-[1400px] mx-auto px-5 md:px-8 pt-8 md:pt-10 pb-10 grid grid-cols-1 lg:grid-cols-3 gap-10">
        
        <aside class="lg:col-span-1">
            <div class="baguette-surface rounded-2xl p-6 sticky top-6">
                <h3 class="font-black text-xl mb-1 flex items-center gap-2">
                    <i class="fas fa-plus-circle text-white/40"></i> Nouvelle Offre
                </h3>
                <p class="text-[11px] text-white/45 mb-5">Publiez une mission pour attirer les meilleurs closers.</p>
                
                <form action="/company/create-offer" method="POST" class="space-y-4">
                    <div>
                        <label class="block text-[10px] uppercase font-bold text-white/50 mb-1">Titre du poste</label>
                        <input type="text" name="title" required placeholder="Ex: Closer High Ticket B2B" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-white/40 focus:outline-none transition-colors placeholder-white/20">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-white/50 mb-1">Rémunération</label>
                            <input type="text" 
                                   name="remuneration" 
                                   placeholder="Ex: 15% / CA" 
                                   class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-white/40 focus:outline-none transition-colors placeholder-white/20"
                                   onblur="if(this.value && !this.value.includes('%') && /^[0-9.,]+$/.test(this.value.trim())) { this.value = this.value.trim() + '%' }">
                        </div>
                        <div>
                            <label class="block text-[10px] uppercase font-bold text-white/50 mb-1">Type</label>
                            <select name="missionType" class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-white/40 focus:outline-none">
                                <option value="Long terme">Long terme</option>
                                <option value="Mission">Mission courte</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] uppercase font-bold text-white/50 mb-1">Niche / Secteur</label>
                        <input type="text" name="niche" placeholder="Ex: Infopreneuriat, Solar, Immo..." class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-white/40 focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-[10px] uppercase font-bold text-white/50 mb-1">Description du poste</label>
                        <textarea name="description" rows="4" required placeholder="Décrivez votre offre, les pré-requis..." class="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-white/40 focus:outline-none"></textarea>
                    </div>

                    <button type="submit" class="w-full py-4 rounded-xl bg-white text-black font-black uppercase tracking-widest text-xs hover:bg-slate-200 transition-colors shadow-lg">
                        Publier l'annonce
                    </button>
                </form>
            </div>
        </aside>

        <main class="lg:col-span-2">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <p class="text-accent-400 text-[11px] font-semibold tracking-[0.32em] uppercase mb-2 flex items-center gap-2">
                        <span class="w-5 h-px bg-accent-500"></span> Mes annonces
                    </p>
                    <h3 class="font-black text-2xl text-white">Annonces actives</h3>
                </div>
                <div class="hidden sm:inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/[0.03] border border-white/[0.06]">
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
                    <span class="text-[11px] text-white/65 font-medium"><%= myOffers.length %> mission<%= myOffers.length > 1 ? 's' : '' %></span>
                </div>
            </div>

            <div class="space-y-4">
                <% if(myOffers.length === 0) { %>
                    <div class="text-center py-12 border border-dashed border-white/10 rounded-2xl bg-white/[0.02]">
                        <p class="text-white/30">Vous n'avez posté aucune annonce.</p>
                    </div>
                <% } %>

                <% myOffers.forEach(offer => { %>
                    <article class="bg-[#09090b]/90 border border-white/10 rounded-2xl p-6 flex flex-col sm:flex-row justify-between gap-6 hover:border-white/20 hover:bg-[#09090b] transition-colors relative overflow-hidden">
                        <div class="absolute inset-0 opacity-0 pointer-events-none group-hover:opacity-100 transition-opacity duration-500" style="background: radial-gradient(700px 360px at 95% 20%, rgba(139,92,246,0.10), transparent 60%);"></div>

                        <div class="relative">
                            <h4 class="font-bold text-lg text-white mb-1"><%= offer.title %></h4>
                            <div class="flex items-center gap-3 text-xs text-white/40 mb-3 font-mono">
                                <span><%= new Date(offer.createdAt).toLocaleDateString() %></span>
                                <span>•</span>
                                <span><%= offer.remuneration %></span>
                                <% if (offer.missionType) { %>
                                    <span>•</span>
                                    <span><%= offer.missionType %></span>
                                <% } %>
                            </div>
                            <div class="flex items-center gap-2 flex-wrap">
                                <span class="px-2 py-1 rounded bg-white/5 text-[10px] uppercase font-bold text-white/60">
                                    <%= offer.applicants.length %> Candidat<%= offer.applicants.length > 1 ? 's' : '' %>
                                </span>
                                <% if (offer.niche) { %>
                                    <span class="px-2 py-1 rounded bg-white/5 text-[10px] uppercase font-bold text-white/50 border border-white/10 flex items-center gap-1">
                                        <i class="fas fa-tag text-[9px] opacity-70"></i> <%= offer.niche %>
                                    </span>
                                <% } %>
                            </div>
                        </div>

                        <div class="relative flex items-center gap-3">
                            <a href="/company/offer/<%= offer._id %>/candidats" class="px-5 py-2.5 rounded-lg bg-white/5 hover:bg-white/10 text-white text-xs font-bold uppercase tracking-wide border border-white/10 transition-colors">
                                Voir candidats
                            </a>
                            <form action="/company/delete-offer/<%= offer._id %>" method="POST" onsubmit="return confirm('Supprimer cette offre ?');">
                                <button type="submit" class="w-10 h-10 flex items-center justify-center rounded-lg bg-red-500/10 text-red-400 hover:bg-red-500/20 transition-colors">
                                    <i class="fas fa-trash-alt text-xs"></i>
                                </button>
                            </form>
                        </div>
                    </article>
                <% }) %>
            </div>
        </main>
    </div>
</body>
</html>