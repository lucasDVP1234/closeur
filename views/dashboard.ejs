<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cockpit — SEFAIRECLOSER.COM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        display: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        surface: { 50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8', 800: '#111113', 900: '#09090b', 950: '#050506' },
                        accent: { 400: '#a78bfa', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9' },
                    }
                }
            }
        }
    </script>
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: #050506; color: #fafafa; overflow-x: hidden; }

        /* Grain */
        body::before {
            content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/7000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.5;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(139,92,246,0.25); border-radius: 99px; }
        ::selection { background: rgba(139,92,246,0.4); color: white; }

        /* Gradient line */
        .gradient-line {
            height: 2px;
            background: linear-gradient(90deg, transparent, #8b5cf6, #a78bfa, #8b5cf6, transparent);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer { 0%,100% { background-position: 200% 0; } 50% { background-position: -200% 0; } }

        /* Stagger */
        .stagger-in { opacity: 0; transform: translateY(20px); animation: fadeUp 0.5s cubic-bezier(0.22,1,0.36,1) forwards; }
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

        /* Input global */
        .field-input {
            width: 100%; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.07);
            border-radius: 12px; padding: 12px 14px; color: white; font-size: 14px;
            transition: all 0.25s ease; font-family: 'Outfit', sans-serif;
        }
        .field-input:focus { outline: none; border-color: #8b5cf6; box-shadow: 0 0 0 3px rgba(139,92,246,0.12); }
        .field-input::placeholder { color: rgba(255,255,255,0.12); }
        .field-input:disabled { opacity: 0.35; cursor: not-allowed; }

        select.field-input { appearance: none; cursor: pointer; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/7000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.25)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; }

        textarea.field-input { resize: vertical; min-height: 80px; line-height: 1.6; }

        /* Checkbox tag chip */
        .chip-check { cursor: pointer; user-select: none; }
        .chip-check input { position: absolute; opacity: 0; pointer-events: none; }
        .chip-label {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 14px; border-radius: 10px;
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
            transition: all 0.2s ease; font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.4);
        }
        .chip-check input:checked + .chip-label {
            background: rgba(139,92,246,0.12); border-color: rgba(139,92,246,0.35); color: rgba(255,255,255,0.85);
        }
        .chip-check:hover .chip-label { border-color: rgba(255,255,255,0.12); }

        /* Section toggle */
        .section-toggle { cursor: pointer; user-select: none; }
        .section-body { max-height: 1200px; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.22,1,0.36,1), opacity 0.3s; opacity: 1; }
        .section-body.collapsed { max-height: 0; opacity: 0; }
        .section-chevron { transition: transform 0.3s ease; }
        .section-chevron.rotated { transform: rotate(-90deg); }

        /* Photo upload hover */
        .photo-upload:hover .photo-overlay { opacity: 1; }
        .photo-overlay { opacity: 0; transition: opacity 0.3s ease; }

        /* Toast */
        .toast { transform: translateY(20px); opacity: 0; transition: all 0.4s cubic-bezier(0.22,1,0.36,1); }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* Preview card hover */
        .preview-card { transition: box-shadow 0.3s ease; }
        .preview-card:hover { box-shadow: 0 0 40px rgba(139,92,246,0.08); }

        /* Stat block */
        .stat-block {
            background: linear-gradient(135deg, rgba(139,92,246,0.06), rgba(139,92,246,0.01));
            border: 1px solid rgba(139,92,246,0.1);
        }
        .card-premium {
            border: 1px solid rgba(245, 158, 11, 0.5) !important;
            box-shadow: 0 0 35px rgba(245, 158, 11, 0.15) !important;
            background: linear-gradient(180deg, rgba(245, 158, 11, 0.03) 0%, rgba(0,0,0,0) 100%) !important;
        }
        .text-gold { color: #fbbf24; text-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
        .border-gold { border-color: rgba(245, 158, 11, 0.3) !important; }
        .bg-gold-subtle { background: rgba(245, 158, 11, 0.05) !important; }
    </style>
</head>
<body class="min-h-screen pb-24">

<!-- ═══════════════ NAV ═══════════════ -->
<nav class="sticky top-0 z-50 bg-surface-950 backdrop-blur-2xl border-b border-white/[0.04]">
    <div class="max-w-[1400px] mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
        
        <div class="flex items-center gap-2 md:gap-4">
            <a href="/" class="group flex items-center gap-2 md:gap-3 select-none">
                <div class="relative w-8 h-8 rounded-lg bg-accent-600 flex items-center justify-center overflow-hidden group-hover:rounded-xl transition-all duration-300 shrink-0">
                    <span class="text-white font-black text-sm tracking-tight">SFC</span>
                    <div class="absolute inset-0 bg-white/70 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                </div>
                <span class="text-[10px] md:text-sm font-bold tracking-normal md:tracking-[0.2em] uppercase text-white/80 group-hover:text-white transition-colors whitespace-nowrap">
                    SEFAIRECLOSER.COM
                </span>
            </a>

            <div class="hidden sm:flex items-center gap-1.5 bg-accent-600/10 border border-accent-500/70 px-2.5 py-1 rounded-lg shrink-0">
                <span class="w-1.5 h-1.5 bg-accent-400 rounded-full animate-pulse"></span>
                <span class="text-[10px] font-bold uppercase tracking-widest text-accent-400">Cockpit</span>
            </div>
        </div>

        <div class="flex items-center gap-2 md:gap-3">
            <a href="/" class="flex items-center gap-2 text-white/70 hover:text-white text-xs font-medium transition-colors px-2 md:px-3 py-2 rounded-lg hover:bg-white/[0.05]">
                <i class="fas fa-globe text-xs md:text-[10px]"></i> 
                <span class="hidden sm:inline uppercase tracking-wide">Annuaire</span>
            </a>
            
            <div class="w-px h-5 bg-white/[0.06]"></div>
            
            <a href="/logout" class="w-8 h-8 md:w-9 md:h-9 flex items-center justify-center rounded-full bg-white/[0.04] hover:bg-red-500/15 border border-white/[0.06] hover:border-red-500/30 transition-all duration-300 group shrink-0">
                <i class="fas fa-arrow-right-from-bracket text-[10px] md:text-[11px] text-white/30 group-hover:text-red-400 transition-colors"></i>
            </a>
        </div>
    </div>
</nav>

<div class="max-w-[1400px] mx-auto px-5 md:px-8">

    <!-- ═══════════════ HEADER ═══════════════ -->
    <header class="pt-10 pb-8 stagger-in" style="animation-delay:0.05s">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-5">
            <div>
                <p class="text-accent-400 text-xs font-semibold tracking-[0.3em] uppercase mb-3 flex items-center gap-2">
                    <span class="w-6 h-px bg-accent-500"></span> Espace personnel
                </p>
                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight">
                    Bon retour, <span class="text-accent-400"><%= closer.prenom %></span>.
                </h2>
                <p class="text-white text-sm mt-2 font-light">Gérez votre profil et vos disponibilités depuis votre cockpit.</p>
            </div>

            <!-- Status pill -->
            <div class="flex items-center gap-4 bg-white/[0.03] border border-white/[0.06] rounded-2xl px-5 py-3.5 shrink-0">
                <div class="text-right">
                    <p class="text-[10px] text-white/70 uppercase font-bold tracking-wider mb-0.5">Statut</p>
                    <p class="text-sm font-bold text-emerald-400"><%= closer.availability %></p>
                </div>
                <div class="relative">
                    <div class="w-3 h-3 bg-emerald-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-emerald-500 rounded-full absolute inset-0 animate-ping opacity-40"></div>
                </div>
            </div>
        </div>
        <div class="gradient-line mt-8 rounded-full"></div>
    </header>

    <!-- ═══════════════ MAIN GRID ═══════════════ -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 stagger-in" style="animation-delay:0.15s">

        <!-- ══════ LEFT: PREVIEW ══════ -->
        <aside class="lg:col-span-4 xl:col-span-4 space-y-5">

            <p class="text-[10px] uppercase font-bold text-white/70 tracking-[0.2em] flex items-center gap-2">
                <i class="fas fa-eye text-accent-500/40 text-[9px]"></i> Aperçu public
            </p>

            <!-- Preview card -->
            <div class="preview-card rounded-2xl overflow-hidden <%= closer.isPremium ? 'card-premium' : 'bg-white/[0.02] border border-white/[0.06]' %>">
                <div class="h-72 relative overflow-hidden">
                    <img src="<%= closer.photoUrl %>" alt="Photo" class="w-full h-full object-cover" style="filter: saturate(0.85) brightness(0.9);">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-surface-950 via-surface-950/40 to-transparent"></div>

                    <div class="absolute top-3 left-3 z-20 flex flex-col gap-1.5 items-start">
                        
                        <% if(closer.isPremium) { %>
                            <span class="bg-gradient-to-br from-accent-400 via-slate-50 to-slate-300 border border-white/60 text-slate-900 px-3 py-1 text-[9px] font-black uppercase tracking-[0.25em] leading-none rounded-lg shadow-md flex items-center gap-2">
                                <i class="far fa-gem text-[9px] text-slate-600"></i> Élite
                            </span>
                        <% } %>

                        <% if(closer.yearsExperience > 0) { %>
                            <span class="bg-surface-950/80 backdrop-blur-md border border-white/10 px-2.5 py-1 text-[10px] font-bold uppercase tracking-wide rounded-lg text-white/80">
                                <%= closer.yearsExperience %> ans d'exp.
                            </span>
                        <% } %>

                        <% if(closer.totalClosed > 0) { %>
                            <span class="bg-emerald-600/80 backdrop-blur-md px-2.5 py-1 text-[10px] font-bold uppercase rounded-lg text-white">
                                <%= closer.totalClosed ? closer.totalClosed.toLocaleString() : '0' %>€ closés
                            </span>
                        <% } %>
                    </div>

                    <div class="absolute top-3 right-3 z-20">
                        <span class="bg-accent-600/90 backdrop-blur-md px-2.5 py-1 text-[10px] font-bold uppercase rounded-lg text-white">
                            <%= closer.profileType %>
                        </span>
                    </div>

                    <div class="absolute bottom-4 left-4 right-4 z-20">
                        <h3 class="text-xl font-bold text-white leading-tight"><%= closer.prenom %> <span class="text-white/70"><%= closer.nom.charAt(0) %>.</span></h3>
                        <p class="text-accent-400 text-[11px] font-mono font-medium mt-0.5 uppercase tracking-wide"><%= closer.market %> · <%= closer.missionType %></p>
                    </div>
                </div>

                <div class="p-4">
                    <div class="flex flex-wrap gap-1.5 mb-3">
                        <% if(closer.productTypes && closer.productTypes.length > 0) { %>
                            <% closer.productTypes.slice(0, 4).forEach(type => { %>
                                <span class="px-2 py-0.5 bg-white/[0.04] border border-white/[0.06] rounded-md text-[10px] uppercase font-medium text-white/35"><%= type %></span>
                            <% }) %>
                            <% if(closer.productTypes.length > 4) { %>
                                <span class="px-2 py-0.5 text-[10px] font-mono font-bold text-accent-400">+<%= closer.productTypes.length - 4 %></span>
                            <% } %>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Philosophy -->
            <div class="bg-white/[0.02] border border-accent-500/10 rounded-2xl p-5">
                <p class="text-[10px] uppercase font-bold text-accent-400/60 tracking-wider mb-2.5 flex items-center gap-1.5">
                    <i class="fas fa-quote-left text-[8px]"></i> Votre philosophie
                </p>
                <p class="text-sm text-white/35 italic leading-relaxed font-light">
                    "<%= closer.closingPhilosophy || 'Non définie…' %>"
                </p>
            </div>

            <!-- Quick stats -->
            <div class="grid grid-cols-2 gap-3">
                <div class="stat-block rounded-xl p-4">
                    <p class="text-[9px] uppercase font-bold text-white/70 tracking-wider mb-1">Total Closé</p>
                    <p class="text-lg font-bold font-mono text-white/80"><%= closer.totalClosed ? closer.totalClosed.toLocaleString() : '0' %><span class="text-accent-400 text-sm">€</span></p>
                </div>
                <div class="stat-block rounded-xl p-4">
                    <p class="text-[9px] uppercase font-bold text-white/70 tracking-wider mb-1">Objectif</p>
                    <p class="text-lg font-bold font-mono text-white/80"><%= closer.desiredIncome ? closer.desiredIncome.toLocaleString() : '—' %><span class="text-white/30 text-sm"><%= closer.desiredIncome ? '€/m' : '' %></span></p>
                </div>
            </div>
        </aside>

        <!-- ══════ RIGHT: EDIT FORM ══════ -->
        <div class="lg:col-span-8 xl:col-span-8">

            <div class="bg-white/[0.015] border border-white/[0.05] rounded-3xl overflow-hidden">

                <!-- Form header -->
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 px-7 md:px-9 pt-7 md:pt-9 pb-5 border-b border-white/[0.04]">
                    <div>
                        <h3 class="text-xl font-bold tracking-tight">Édition du profil</h3>
                        <p class="text-white/70 text-xs mt-1 font-light">Les modifications sont visibles immédiatement sur l'annuaire.</p>
                    </div>
                    <button form="updateForm" type="submit" id="saveBtn"
                        class="bg-white text-surface-950 hover:bg-accent-500 hover:text-white px-6 py-3 rounded-xl font-bold text-xs uppercase tracking-wider transition-all duration-300 shadow-lg shadow-white/5 hover:shadow-accent-500/70 flex items-center gap-2.5 shrink-0 group">
                        <i class="fas fa-check text-[10px] group-hover:rotate-12 transition-transform"></i> Sauvegarder
                    </button>
                </div>

                <form id="updateForm" action="/dashboard/update" method="POST" enctype="multipart/form-data" class="px-7 md:px-9 py-7 md:py-8 space-y-0">

                    <!-- ──── Section 1: Identité ──── -->
                    <div class="pb-7 border-b border-white/[0.04]">
                        <div class="section-toggle flex items-center justify-between mb-6" onclick="toggleSection(this)">
                            <h4 class="text-xs font-bold uppercase tracking-[0.15em] text-white flex items-center gap-2.5">
                                <span class="w-5 h-5 rounded-md bg-accent-600/15 flex items-center justify-center"><i class="fas fa-user text-accent-400 text-[9px]"></i></span>
                                Identité & Contact
                            </h4>
                            <i class="fas fa-chevron-down section-chevron text-[10px] text-white/15"></i>
                        </div>

                        <div class="section-body">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <!-- Photo -->
                                <div class="md:col-span-1">
                                    <div class="photo-upload relative w-full aspect-square bg-white/[0.02] border-2 border-dashed border-white/[0.08] rounded-2xl overflow-hidden cursor-pointer group hover:border-accent-500/40 transition-all">
                                        <input type="file" name="photo" class="absolute inset-0 opacity-0 cursor-pointer z-20">
                                        <img src="<%= closer.photoUrl %>" class="absolute inset-0 w-full h-full object-cover" style="filter: brightness(0.6);">
                                        <div class="photo-overlay absolute inset-0 bg-surface-950 flex flex-col items-center justify-center z-10">
                                            <div class="w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center mb-2">
                                                <i class="fas fa-camera text-white/60"></i>
                                            </div>
                                            <span class="text-[10px] text-white/40 font-medium">Changer la photo</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Fields -->
                                <div class="md:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Prénom</label>
                                        <input type="text" name="prenom" value="<%= closer.prenom %>" class="field-input">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Nom</label>
                                        <input type="text" name="nom" value="<%= closer.nom %>" class="field-input">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Email <span class="text-white/10 normal-case">(non modifiable)</span></label>
                                        <input type="email" value="<%= closer.email %>" disabled class="field-input">
                                    </div>
                                    <div>
                                        <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Téléphone</label>
                                        <input type="text" name="telephone" value="<%= closer.telephone %>" class="field-input" placeholder="+33 6 00 00 00 00">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ──── Section 2: Expertise ──── -->
                    <div class="py-7 border-b border-white/[0.04]">
                        <div class="section-toggle flex items-center justify-between mb-6" onclick="toggleSection(this)">
                            <h4 class="text-xs font-bold uppercase tracking-[0.15em] text-white flex items-center gap-2.5">
                                <span class="w-5 h-5 rounded-md bg-accent-600/15 flex items-center justify-center"><i class="fas fa-crosshairs text-accent-400 text-[9px]"></i></span>
                                Expertise & Positionnement
                            </h4>
                            <i class="fas fa-chevron-down section-chevron text-[10px] text-white/15"></i>
                        </div>

                        <div class="section-body">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-5">
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Profil principal</label>
                                    <select name="profileType" class="field-input">
                                        <option value="Closeur" <%= closer.profileType === 'Closeur' ? 'selected' : '' %>>Closeur</option>
                                        <option value="Commercial" <%= closer.profileType === 'Commercial' ? 'selected' : '' %>>Commercial</option>
                                        <option value="Setter" <%= closer.profileType === 'Setter' ? 'selected' : '' %>>Setter</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Marché cible</label>
                                    <select name="market" class="field-input">
                                        <option value="B2C" <%= closer.market === 'B2C' ? 'selected' : '' %>>B2C</option>
                                        <option value="B2B" <%= closer.market === 'B2B' ? 'selected' : '' %>>B2B</option>
                                        <option value="Les deux" <%= closer.market === 'Les deux' ? 'selected' : '' %>>B2B & B2C</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Type de mission</label>
                                    <select name="missionType" class="field-input">
                                        <option value="Mission (Webi/Challenge)" <%= closer.missionType === 'Mission (Webi/Challenge)' ? 'selected' : '' %>>Mission (Webi/Challenge)</option>
                                        <option value="Long terme" <%= closer.missionType === 'Long terme' ? 'selected' : '' %>>Long terme</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Années d'expérience</label>
                                    <input type="number" name="yearsExperience" value="<%= closer.yearsExperience %>" class="field-input font-mono" min="0">
                                </div>
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Total closé (€)</label>
                                    <input type="number" name="totalClosed" value="<%= closer.totalClosed %>" class="field-input font-mono" min="0">
                                </div>
                            </div>

                            <!-- Product types chips -->
                            <div>
                                <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-3">Produits maîtrisés</label>
                                <%
                                const productOpts = [
                                    { value: 'Crypto_Trading', label: 'Crypto & Trading', icon: 'fa-bitcoin-sign' },
                                    { value: 'Ecommerce_Dropshipping', label: 'E-com & Drop', icon: 'fa-cart-shopping' },
                                    { value: 'Marketing_SMMA', label: 'Marketing & SMMA', icon: 'fa-bullhorn' },
                                    { value: 'Creation_contenu', label: 'CM & Creation de contenu', icon: 'fa-graduation-cap' },
                                    { value: 'Coaching_Business', label: 'Coaching Business', icon: 'fa-handshake' },
                                    { value: 'IA', label: 'Intelligence Artificielle', icon: 'fa-microchip' },
                                    { value: 'SaaS_B2B', label: 'SaaS B2B', icon: 'fa-cloud' },
                                    { value: 'Fitness', label: 'Fitness & Santé', icon: 'fa-dumbbell' },
                                    { value: 'Dev_Perso', label: 'Dév. Personnel', icon: 'fa-brain' },
                                    { value: 'Love_Coaching', label: 'Love Coaching', icon: 'fa-heart' },
                                    { value: 'Energies', label: 'Énergies Renouvelables', icon: 'fa-solar-panel' },
                                ];
                                %>
                                <div class="flex flex-wrap gap-2">
                                    <% productOpts.forEach(opt => { %>
                                        <label class="chip-check">
                                            <input type="checkbox" name="productTypes" value="<%= opt.value %>" <%= closer.productTypes && closer.productTypes.includes(opt.value) ? 'checked' : '' %>>
                                            <div class="chip-label">
                                                <i class="fas <%= opt.icon %> text-[10px] text-white/90"></i>
                                                <span><%= opt.label %></span>
                                            </div>
                                        </label>
                                    <% }) %>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ──── Section 3: Conditions ──── -->
                    <div class="py-7 border-b border-white/[0.04]">
                        <div class="section-toggle flex items-center justify-between mb-6" onclick="toggleSection(this)">
                            <h4 class="text-xs font-bold uppercase tracking-[0.15em] text-white flex items-center gap-2.5">
                                <span class="w-5 h-5 rounded-md bg-accent-600/15 flex items-center justify-center"><i class="fas fa-handshake-angle text-accent-400 text-[9px]"></i></span>
                                Conditions & Disponibilité
                            </h4>
                            <i class="fas fa-chevron-down section-chevron text-[10px] text-white/15"></i>
                        </div>

                        <div class="section-body">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Disponibilité</label>
                                    <select name="availability" class="field-input">
                                        <option value="Full Time" <%= closer.availability === 'Full Time' ? 'selected' : '' %>>Full Time</option>
                                        <option value="Mi-temps" <%= closer.availability === 'Mi-temps' ? 'selected' : '' %>>Mi-temps</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Revenu souhaité / mois (€)</label>
                                    <input type="number" name="desiredIncome" value="<%= closer.desiredIncome %>" class="field-input font-mono" placeholder="3000" min="0">
                                </div>
                            </div>

                            <div>
                                <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-3">Contrats acceptés</label>
                                <div class="flex flex-wrap gap-2">
                                    <label class="chip-check">
                                        <input type="checkbox" name="contractType" value="100% Commission" <%= closer.contractType && closer.contractType.includes('100% Commission') ? 'checked' : '' %>>
                                        <div class="chip-label">
                                            <i class="fas fa-percent text-[9px] text-white/70"></i>
                                            <span>100% Commission</span>
                                        </div>
                                    </label>
                                    <label class="chip-check">
                                        <input type="checkbox" name="contractType" value="Fixe + Commission" <%= closer.contractType && closer.contractType.includes('Fixe + Commission') ? 'checked' : '' %>>
                                        <div class="chip-label">
                                            <i class="fas fa-coins text-[9px] text-white/70"></i>
                                            <span>Fixe + Commission</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ──── Section 4: Track Record ──── -->
                    <div class="pt-7">
                        <div class="section-toggle flex items-center justify-between mb-6" onclick="toggleSection(this)">
                            <h4 class="text-xs font-bold uppercase tracking-[0.15em] text-white flex items-center gap-2.5">
                                <span class="w-5 h-5 rounded-md bg-accent-600/15 flex items-center justify-center"><i class="fas fa-trophy text-accent-400 text-[9px]"></i></span>
                                Track Record & Vision
                            </h4>
                            <i class="fas fa-chevron-down section-chevron text-[10px] text-white/15"></i>
                        </div>

                        <div class="section-body">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-5">
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Lien vidéo <span class="text-white/10 normal-case">(Loom / YouTube)</span></label>
                                    <input type="url" name="videoUrl" value="<%= closer.videoUrl %>" placeholder="https://…" class="field-input">
                                </div>
                                <div>
                                    <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Anciens clients</label>
                                    <input type="text" name="pastClients" value="<%= closer.pastClients %>" placeholder="Client A, Client B…" class="field-input">
                                </div>
                            </div>

                            <div>
                                <label class="block text-[10px] uppercase text-white/70 font-bold tracking-wider mb-2">Votre vision du closing</label>
                                <textarea name="closingPhilosophy" class="field-input" rows="3" placeholder="Un bon closeur, c'est…"><%= closer.closingPhilosophy %></textarea>
                            </div>
                        </div>
                    </div>

                </form>

                <!-- Bottom save bar -->
                <div class="px-7 md:px-9 py-5 bg-white/[0.02] border-t border-white/[0.04] flex items-center justify-between">
                    <p class="text-[11px] text-white/15 font-light"><i class="fas fa-info-circle mr-1"></i> Toutes les modifications se reflètent en temps réel.</p>
                    <button form="updateForm" type="submit"
                        class="bg-accent-600 hover:bg-accent-700 text-white px-5 py-2.5 rounded-xl font-bold text-xs uppercase tracking-wider transition-all duration-300 shadow-lg shadow-accent-600/15 flex items-center gap-2">
                        <i class="fas fa-save text-[10px]"></i> Enregistrer
                    </button>
                </div>
                </div> 
                <% if (closer.isPremium) { %>
                <div class="mt-6 flex flex-col items-end">
                    <p class="text-[10px] text-white/30 mb-2 italic">Facturation & Abonnement</p>
                    <form action="/create-portal-session" method="POST">
                        <button type="submit" class="group flex items-center gap-3 px-5 py-3 rounded-xl border border-white/10 hover:border-white/20 bg-white/[0.03] hover:bg-white/[0.06] transition-all duration-300">
                            <div class="w-6 h-6 rounded-md bg-white/10 flex items-center justify-center group-hover:bg-white/20 transition-colors">
                                <i class="fas fa-file-invoice-dollar text-white/70 text-[10px]"></i>
                            </div>
                            
                            <div class="text-left">
                                <span class="block text-[10px] font-bold uppercase tracking-widest text-white/80 group-hover:text-white transition-colors">
                                    Gérer mon abonnement
                                </span>
                                <span class="block text-[9px] text-white/40">
                                    Factures, Moyen de paiement, Résiliation
                                </span>
                            </div>
                            
                            <i class="fas fa-external-link-alt text-white/30 text-[10px] ml-1 group-hover:text-white transition-colors"></i>
                        </button>
                    </form>
                </div>
            <% } %>
            </div>
        </div>
    </div>
</div>

<!-- ═══════════════ TOAST ═══════════════ -->
<div id="toast" class="toast fixed bottom-6 right-6 z-[200] bg-emerald-600/90 backdrop-blur-xl border border-emerald-400/70 text-white px-5 py-3.5 rounded-xl shadow-2xl shadow-emerald-600/70 flex items-center gap-3">
    <div class="w-7 h-7 rounded-lg bg-white/70 flex items-center justify-center shrink-0">
        <i class="fas fa-check text-sm"></i>
    </div>
    <span class="text-sm font-semibold">Profil mis à jour avec succès</span>
</div>

<!-- ═══════════════ FOOTER ═══════════════ -->
<footer class="border-t border-white/[0.04] py-8 mt-16">
    <div class="max-w-[1400px] mx-auto px-5 md:px-8 flex flex-col md:flex-row items-center justify-between gap-3">
        <span class="text-[11px] text-white/15 font-medium tracking-wide">© 2025 The Closers. Tous droits réservés.</span>
        <div class="flex items-center gap-1">
            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500/60 animate-pulse"></span>
            <span class="text-[11px] text-white/70 font-medium">Plateforme active</span>
        </div>
    </div>
</footer>

<script>
    // --- Section toggle ---
    function toggleSection(trigger) {
        const body = trigger.nextElementSibling;
        const chevron = trigger.querySelector('.section-chevron');
        body.classList.toggle('collapsed');
        chevron.classList.toggle('rotated');
    }

    // --- Toast on success (URL param) ---
    (() => {
        const params = new URLSearchParams(window.location.search);
        if (params.get('success') === '1') {
            const toast = document.getElementById('toast');
            setTimeout(() => toast.classList.add('show'), 200);
            setTimeout(() => toast.classList.remove('show'), 3500);
            // Clean URL
            window.history.replaceState({}, '', window.location.pathname);
        }
    })();

    // --- Photo preview ---
    document.querySelector('input[name="photo"]')?.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
            // Update both preview images
            document.querySelectorAll('img[src="<%= closer.photoUrl %>"]').forEach(img => {
                img.src = ev.target.result;
            });
        };
        reader.readAsDataURL(file);
    });

    // --- Unsaved changes warning ---
    let formChanged = false;
    document.getElementById('updateForm')?.addEventListener('input', () => { formChanged = true; });
    window.addEventListener('beforeunload', (e) => {
        if (formChanged) { e.preventDefault(); e.returnValue = ''; }
    });
    document.getElementById('updateForm')?.addEventListener('submit', () => { formChanged = false; });
</script>

</body>
</html>
