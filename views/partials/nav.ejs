<!-- ═══════════════ NAV (shared) ═══════════════ -->
<nav class="sticky top-0 z-[60] bg-[#050506] md:bg-surface-950/80 md:backdrop-blur-2xl border-b border-white/[0.04]">
  <div class="max-w-[1400px] mx-auto px-4 md:px-8 h-16 flex items-center justify-between gap-2">
    
    <a href="/" class="group flex items-center gap-2.5 md:gap-3.5 select-none shrink-0 z-50 relative">
      <!-- Logo mark -->
      <div class="relative w-9 h-9 md:w-10 md:h-10 shrink-0">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full drop-shadow-[0_0_12px_rgba(139,92,246,0.35)] group-hover:drop-shadow-[0_0_20px_rgba(139,92,246,0.55)] transition-all duration-500">
          <path d="M20 2L38 20L20 38L2 20Z" fill="url(#logo-grad)" stroke="rgba(255,255,255,0.15)" stroke-width="0.8"/>
          <line x1="20" y1="10" x2="20" y2="16" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.9"/>
          <line x1="20" y1="24" x2="20" y2="30" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.9"/>
          <line x1="10" y1="20" x2="16" y2="20" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.9"/>
          <line x1="24" y1="20" x2="30" y2="20" stroke="white" stroke-width="1.5" stroke-linecap="round" opacity="0.9"/>
          <circle cx="20" cy="20" r="2.5" fill="white"/>
          <circle cx="20" cy="20" r="2.5" fill="white" opacity="0.5" style="animation: ping 3s cubic-bezier(0,0,0.2,1) infinite;"/>
          <defs>
            <linearGradient id="logo-grad" x1="2" y1="2" x2="38" y2="38" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#a78bfa"/>
              <stop offset="55%" stop-color="#7c3aed"/>
              <stop offset="100%" stop-color="#1a1625"/>
            </linearGradient>
          </defs>
        </svg>
        <style>@keyframes ping{75%,100%{transform:scale(2.2);opacity:0;}}</style>
      </div>
      <!-- Brand text -->
      <div class="flex flex-col justify-center leading-none">
        <span class="text-[13px] md:text-[15px] font-extrabold tracking-tight text-white group-hover:text-white transition-colors whitespace-nowrap">
          CLOSER<span class="text-accent-400">.</span>
        </span>
        <span class="text-[8px] md:text-[9px] font-medium tracking-[0.25em] uppercase text-white/35 group-hover:text-white/55 transition-colors whitespace-nowrap mt-0.5">
          sefairecloser.com
        </span>
      </div>
    </a>

    <div class="hidden md:flex items-center gap-4">
      
      <% if (!user) { %>
        <a href="/" class="text-xs font-bold uppercase tracking-widest text-white/60 hover:text-white transition-colors flex items-center gap-2 px-3 py-2">
          <i class="fas fa-users text-[10px]"></i> Voir les closers
        </a>
      <% } %>

      <% if (!user || user.role === 'closer') { %>
        <a href="/offres" class="text-xs font-bold uppercase tracking-widest text-white/60 hover:text-white transition-colors flex items-center gap-2 px-3 py-2">
          <i class="fas fa-briefcase text-[10px]"></i> Voir les missions
        </a>
      <% } %>

      <% if (user) { %>

        <% if (user.role === 'company') { %>
          <a href="/" class="text-xs font-bold uppercase tracking-widest text-white/60 hover:text-white transition-colors flex items-center gap-2 px-3 py-2">
            <i class="fas fa-users text-[10px]"></i> Les Closers
          </a>
          <a href="/company/dashboard" class="flex items-center gap-2 bg-white/[0.06] hover:bg-white/[0.1] border border-white/[0.08] hover:border-white/20 px-4 py-2 rounded-full transition-all duration-300 group">
            <i class="fas fa-building text-white/60 group-hover:text-white text-xs"></i>
            <span class="text-xs font-bold text-white/80 group-hover:text-white tracking-wide uppercase">Espace Recruteur</span>
          </a>
        <% } %>
        
        <% if (user.role === 'closer') { %>
          
          <% if (!user.isPremium) { %>
            <button
              onclick="if (typeof openPremiumModal === 'function') { openPremiumModal() } else if (typeof openModal === 'function') { openModal('premium-modal') } else { window.location.href = '/dashboard' }"
              class="relative overflow-hidden group bg-gradient-to-br from-white via-slate-100 to-slate-300 border border-white/60 text-slate-900 px-4 py-2 rounded-full font-black text-[10px] uppercase tracking-[0.15em] shadow-[0_0_15px_rgba(255,255,255,0.2)] hover:shadow-[0_0_30px_rgba(255,255,255,0.4)] transition-all transform hover:scale-105"
            >
              <span class="relative z-10 flex items-center gap-2">
                <i class="far fa-gem text-slate-600"></i> <span>PRO</span>
              </span>
              <div class="absolute inset-0 bg-white/80 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 ease-in-out skew-x-12"></div>
            </button>
          <% } %>

          <a href="/dashboard" class="flex items-center gap-2 bg-white/[0.06] hover:bg-accent-600 border border-white/[0.08] hover:border-accent-500 px-4 py-2 rounded-full transition-all duration-300 group">
            <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse group-hover:bg-white"></span>
            <span class="text-xs font-semibold text-white/70 group-hover:text-white tracking-wide uppercase">Cockpit</span>
          </a>
        <% } %>
        
        <a href="/logout" class="w-9 h-9 flex items-center justify-center rounded-full bg-white/[0.04] hover:bg-red-500/15 border border-white/[0.06] hover:border-red-500/30 transition-all duration-300 group shrink-0" title="Déconnexion">
          <i class="fas fa-power-off text-[10px] text-white/30 group-hover:text-red-400 transition-colors"></i>
        </a>

      <% } else { %>
        <div class="h-4 w-px bg-white/10 mx-1"></div>
        <a href="/login" class="text-white/50 hover:text-white text-xs font-bold tracking-wide uppercase transition-colors px-2">Connexion</a>
        <a href="/register-choice" class="bg-white text-surface-950 hover:bg-accent-500 hover:text-white px-5 py-2.5 rounded-full text-xs font-bold uppercase tracking-wider transition-all duration-300 shadow-lg shadow-white/5 hover:shadow-accent-500/20">Rejoindre</a>
      <% } %>
    </div>

    <button id="mobile-menu-btn" class="md:hidden z-50 w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-white border border-white/10" aria-label="Menu">
      <i class="fas fa-bars"></i>
    </button>

  </div>
</nav>

<!-- ═══════════════ MOBILE MENU (shared) ═══════════════ -->
<div id="mobile-menu" class="fixed inset-0 bg-[#050506]/95 backdrop-blur-xl z-[100] transform translate-x-full transition-transform duration-300 flex flex-col justify-center items-center gap-8 md:hidden">
  
  <% if (!user) { %>
    <a href="/" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Les Closers</a>
  <% } %>

  <% if (!user || user.role === 'closer') { %>
    <a href="/offres" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Les Missions</a>
  <% } %>

  <% if (user) { %>
    <% if (user.role === 'company') { %>
      <a href="/" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Les Closers</a>
      <a href="/company/dashboard" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Espace Recruteur</a>
    <% } %>

    <% if (user.role === 'closer') { %>
      <a href="/dashboard" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Mon Cockpit</a>
      <% if (!user.isPremium) { %>
        <button
          onclick="closeMobileMenu(); if (typeof openPremiumModal === 'function') { openPremiumModal() } else if (typeof openModal === 'function') { openModal('premium-modal') } else { window.location.href = '/dashboard' }"
          class="text-lg font-bold text-slate-300 uppercase tracking-widest border border-white/20 px-6 py-2 rounded-full"
        >
          Devenir Pro
        </button>
      <% } %>
    <% } %>

    <a href="/logout" class="text-lg font-bold text-red-400 uppercase tracking-widest mt-4" onclick="closeMobileMenu()">Se déconnecter</a>
  <% } else { %>
    <a href="/login" class="text-2xl font-black text-white uppercase tracking-widest hover:text-accent-400 transition-colors" onclick="closeMobileMenu()">Connexion</a>
    <a href="/register-choice" class="text-xl font-bold bg-white text-black px-8 py-3 rounded-full uppercase tracking-widest shadow-xl" onclick="closeMobileMenu()">Rejoindre</a>
  <% } %>

  <button onclick="closeMobileMenu()" class="absolute top-6 right-6 text-white/50 hover:text-white p-4" aria-label="Fermer le menu">
    <i class="fas fa-times text-2xl"></i>
  </button>
</div>

<script>
  (function () {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    if (!menuBtn || !mobileMenu) return;

    const icon = menuBtn.querySelector('i');

    window.closeMobileMenu = function closeMobileMenu() {
      mobileMenu.classList.add('translate-x-full');
      if (icon) {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
      }
      document.body.style.overflow = '';
    };

    menuBtn.addEventListener('click', () => {
      const isClosed = mobileMenu.classList.contains('translate-x-full');
      if (isClosed) {
        mobileMenu.classList.remove('translate-x-full');
        if (icon) {
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        }
        document.body.style.overflow = 'hidden';
      } else {
        window.closeMobileMenu();
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') window.closeMobileMenu();
    });
  })();
</script>
